<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body></body>
  <script>
    // 记录节点的入度
    let indegree;
    let memo;
    let src;
    /**
     * @param {number} n
     * @param {number[][]} flights
     * @param {number} src
     * @param {number} dst
     * @param {number} k
     * @return {number}
     */
    var findCheapestPrice = function (n, flights, src, dst, k) {
      this.src = src;
      // k 个中转站则对应 k + 1 条边
      k++;
      memo = new Array(n);
      for (let i = 0; i < n; i++) {
        memo[i] = new Array(k + 1).fill(-888);
      }
      indegree = new Map();
      for (let i = 0; i < flights.length; i++) {
        let from = flights[i][0];
        let to = flights[i][1];
        let price = flights[i][2];
        if (!indegree.has(to)) {
          indegree.set(to, new Array());
        }
        indegree.get(to).push([from, price]);
      }
      let res = dp(dst, k);
      console.log(res);
      console.log(memo);
      return res;
    };

    // dp函数定义：从 src 出发，k 步之内到达 s 的最小成本
    var dp = function (s, k) {
      if (s === src) return 0;
      if (k === 0) return -1;
      if (memo[s][k] !== -888) return memo[s][k];
      let res = Number.MAX_SAFE_INTEGER;
      if (indegree.has(s)) {
        for (let item of indegree.get(s)) {
          let from = item[0];
          let price = item[1];
          let subProblem = dp(from, k - 1);
          console.log(from);
          console.log(price);
          console.log(subProblem);
          if (subProblem !== -1) {
            res = Math.min(res, subProblem + price);
          }
        }
      }
      memo[s][k] = res === Number.MAX_SAFE_INTEGER ? -1 : res;
      return memo[s][k];
    };

    findCheapestPrice(
      4,
      [
        [0, 1, 100],
        [1, 2, 100],
        [2, 0, 100],
        [1, 3, 600],
        [2, 3, 200],
      ],
      0,
      3,
      1
    );
  </script>
</html>
